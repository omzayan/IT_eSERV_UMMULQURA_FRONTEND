<div class="flex flex-col gap-2 items-start w-full">
  <label for="citySelect" class="text-base font-medium text-[#161616]">
    {{ label | translate }}
  </label>

  <div class="relative w-full">
    <img
      src="assets/images/location.png"
      alt="Location"
      class="absolute start-3 top-1/2 transform -translate-y-1/2 w-4 h-4 pointer-events-none z-10"
    />

    <select
      name="citySelect"
      id="citySelect"
      [value]="selectedCity"
      (change)="onCityChange($event)"
      class="ps-10 pe-16 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1B8354] focus:border-transparent w-full appearance-none"
      [disabled]="disabled || loadingCities || !!citiesError"
    >
      <option value="">
        <ng-container *ngIf="loadingCities">
          {{ "citySelect.loadingCities" | translate }}
        </ng-container>
        <ng-container *ngIf="citiesError && !loadingCities">
          {{ citiesError }}
        </ng-container>
        <ng-container *ngIf="!loadingCities && !citiesError">
          {{ "citySelect.selectCityPlaceholder" | translate }}
        </ng-container>
      </option>

   <option *ngFor="let city of cities" [value]="city.id">
  {{ city.name }}
</option>

    </select>

    <!-- Auto-detect Location Button -->
    <button
      type="button"
      (click)="getCurrentLocation()"
      [disabled]="isGettingLocation || disabled"
      class="absolute end-2 top-1/2 transform -translate-y-1/2 p-1.5 text-[#1B8354] hover:bg-[#1B8354] hover:text-white rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed z-10 flex items-center gap-1"
      [title]="'citySelect.getCurrentLocation' | translate"
    >
      <!-- Loading Spinner -->
      <svg
        *ngIf="isGettingLocation"
        class="w-4 h-4 animate-spin"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        ></path>
      </svg>

      <!-- Location Icon -->
      <div *ngIf="!isGettingLocation" class="flex items-center gap-1">
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
          />
        </svg>
        <span class="text-xs hidden sm:inline">{{
          "citySelect.autoDetectLocation" | translate
        }}</span>
      </div>
    </button>
  </div>

  <!-- Display coordinates when auto-detect is used -->
  <div
    *ngIf="currentCoordinates"
    class="mt-2 p-3 bg-gray-50 rounded-md border border-gray-200 w-full"
  >
    <div class="text-sm text-gray-600 mb-1">
      <span class="font-medium">
        {{ "citySelect.detectedLocation" | translate }}:
      </span>
    </div>
    <div class="text-xs text-gray-500 space-y-1">
      <div class="font-mono">
        {{ "citySelect.latitude" | translate }}:
        {{ currentCoordinates.lat | number : "1.6-6" }}
      </div>
      <div class="font-mono">
        {{ "citySelect.longitude" | translate }}:
        {{ currentCoordinates.lng | number : "1.6-6" }}
      </div>
    </div>
  </div>
</div>
