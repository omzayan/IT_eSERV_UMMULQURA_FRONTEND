<!-- زرار فتح الـ Modal -->
<button
  (click)="toggleModal()"
  class="w-full flex items-center justify-between px-4 py-3 border rounded-md bg-white shadow-sm text-[#161616]"
>
  <span>{{ selectedCityName || (label | translate) }}</span>
  <svg
    class="w-5 h-5 text-gray-500"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M19 9l-7 7-7-7"
    />
  </svg>
</button>

<!-- الـ Modal -->
<div
  *ngIf="isOpen"
  class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-end z-50"
>
  <div
    class="bg-white rounded-t-2xl w-full max-w-md max-h-[80%] overflow-y-auto p-4 shadow-lg"
  >
    <!-- Header -->
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold text-[#161616]">
        {{ "citySelect.title" | translate }}
      </h2>
      <button (click)="toggleModal()" class="text-gray-500 text-2xl">
        &times;
      </button>
    </div>

    <!-- Tabs -->
    <div class="flex border-b mb-4">
      <button
        class="flex-1 py-2 text-center"
        [class.border-b-2]="activeTab === 'city'"
        [class.text-green-700]="activeTab === 'city'"
        (click)="activeTab = 'city'"
      >
        {{ "citySelect.byCity" | translate }}
      </button>
      <button
        class="flex-1 py-2 text-center"
        [class.border-b-2]="activeTab === 'coords'"
        [class.text-green-700]="activeTab === 'coords'"
        (click)="activeTab = 'coords'"
      >
        {{ "citySelect.byCoords" | translate }}
      </button>
    </div>

    <!-- اختيار بالمدينة -->
    <div *ngIf="activeTab === 'city'">
      <!-- Input للبحث -->
      <div class="relative w-full mb-3">
        <input
          type="text"
          [(ngModel)]="searchText"
          (input)="filterCities()"
          placeholder="{{ 'citySelect.selectCityPlaceholder' | translate }}"
          class="w-full border rounded-md ps-10 pe-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#1B8354] focus:border-transparent"
        />

        <!-- أيقونة البحث -->
        <svg
          class="absolute start-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
      </div>

      <!-- قائمة المدن -->
      <ul
        class="w-full max-h-60 overflow-y-auto border border-gray-200 rounded-md bg-white shadow"
      >
        <li
          class="px-4 py-2 cursor-pointer hover:bg-[#1B8354] hover:text-white"
          (click)="selectCurrentLocation()"
        >
          {{ "citySelect.currentLocation" | translate }}
        </li>
        <li
          *ngFor="let city of filteredCities"
          class="px-4 py-2 cursor-pointer hover:bg-[#1B8354] hover:text-white"
          (click)="onCitySelect(city)"
        >
          {{ city.cityName }}
        </li>
      </ul>
    </div>

    <!-- اختيار بالإحداثيات -->
    <div *ngIf="activeTab === 'coords'" class="flex flex-col gap-3">
      <input
        type="number"
        step="any"
        [(ngModel)]="coords.lat"
        placeholder="{{ 'citySelect.latitudePlaceholder' | translate }}"
        class="border rounded px-3 py-2"
      />
      <input
        type="number"
        step="any"
        [(ngModel)]="coords.lng"
        placeholder="{{ 'citySelect.longitudePlaceholder' | translate }}"
        class="border rounded px-3 py-2"
      />
      <button
        (click)="onCoordsSelect()"
        class="bg-[#1B8354] text-white py-2 rounded hover:bg-green-800 mt-2"
      >
        {{ "citySelect.showPrayerTimes" | translate }}
      </button>
    </div>
  </div>
</div>
