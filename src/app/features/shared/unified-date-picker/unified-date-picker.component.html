<div class="flex flex-col gap-2 items-start w-full">
  <!-- Label -->
  <label *ngIf="getLabelText()" class="text-base font-medium text-[#161616]">
    {{ getLabelText() | translate }}
  </label>

  <!-- Date Input with Calendar Icon -->
  <div class="relative w-full calendar-container">
    <!-- Calendar Icon -->
    <img
      src="/assets/images/calender-icon.png"
      alt="Calendar"
      class="absolute start-3 top-1/2 transform -translate-y-1/2 w-4 h-4 pointer-events-none z-10"
    />

    <!-- Input Field -->
    <input
      type="text"
      [value]="displayValue"
      [placeholder]="getPlaceholderText()"
      [disabled]="disabled"
      class="ps-10 pe-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#1B8354] focus:border-transparent w-full cursor-pointer"
      readonly
      (click)="toggleCalendar()"
    />

    <!-- Calendar Popup -->
    <div
      *ngIf="showCalendar"
      class="absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-50 min-w-[320px] max-w-[400px] calendar-popup"
    >
      <!-- Calendar Header -->
      <div class="p-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <!-- Navigation Buttons -->
          <button
            type="button"
            class="p-2 hover:bg-gray-100 rounded-md transition-colors rtl:rotate-180"
            (click)="previousMonth()"
            *ngIf="currentViewType === 'day'"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              ></path>
            </svg>
          </button>

          <!-- Title (clickable for navigation) -->
          <div class="flex items-center space-x-2">
            <button
              type="button"
              class="text-lg font-semibold hover:bg-gray-100 px-2 py-1 rounded transition-colors"
              (click)="switchToMonthView()"
              *ngIf="currentViewType === 'day'"
            >
              {{ getMonthDisplayName() }}
            </button>
            <button
              type="button"
              class="text-lg font-semibold hover:bg-gray-100 px-2 py-1 rounded transition-colors"
              (click)="switchToYearView()"
              *ngIf="currentViewType === 'day' || currentViewType === 'month'"
            >
              {{ selectedYear }}
            </button>
            <span
              class="text-lg font-semibold"
              *ngIf="currentViewType === 'year'"
            >
              {{ displayedYears[0] }} -
              {{ displayedYears[displayedYears.length - 1] }}
            </span>
          </div>

          <!-- Navigation Buttons -->
          <button
            type="button"
            class="p-2 hover:bg-gray-100 rounded-md transition-colors rtl:rotate-180"
            (click)="nextMonth()"
            *ngIf="currentViewType === 'day'"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </button>

          <!-- Year navigation buttons -->
          <button
            type="button"
            class="p-2 hover:bg-gray-100 rounded-md transition-colors"
            (click)="previousYearPage()"
            *ngIf="currentViewType === 'year'"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              ></path>
            </svg>
          </button>
          <button
            type="button"
            class="p-2 hover:bg-gray-100 rounded-md transition-colors"
            (click)="nextYearPage()"
            *ngIf="currentViewType === 'year'"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Calendar Content -->
      <div class="p-4">
        <!-- Year Selection View -->
        <div *ngIf="currentViewType === 'year'" class="grid grid-cols-3 gap-2">
          <button
            *ngFor="let year of displayedYears"
            type="button"
            class="p-3 text-center hover:bg-[#1B8354] hover:text-white rounded-md transition-colors"
            [class.selected-date]="year === selectedYear"
            (click)="selectYear(year)"
          >
            {{ year }}
          </button>
        </div>

        <!-- Month Selection View -->
        <div *ngIf="currentViewType === 'month'" class="grid grid-cols-3 gap-2">
          <button
            *ngFor="let month of months; let i = index"
            type="button"
            class="p-3 text-center hover:bg-[#1B8354] hover:text-white rounded-md transition-colors text-sm"
            [class.selected-date]="i + 1 === selectedMonth"
            (click)="selectMonth(i + 1)"
          >
            {{ month.month_name }}
          </button>
        </div>

        <!-- Day Selection View -->
        <div *ngIf="currentViewType === 'day'">
          <!-- Week day headers -->
          <div class="grid grid-cols-7 gap-1 mb-2">
            <div class="text-center text-sm font-medium text-gray-600 p-2">
              {{ "calendar.days.sat" | translate }}
            </div>
            <div class="text-center text-sm font-medium text-gray-600 p-2">
              {{ "calendar.days.sun" | translate }}
            </div>
            <div class="text-center text-sm font-medium text-gray-600 p-2">
              {{ "calendar.days.mon" | translate }}
            </div>
            <div class="text-center text-sm font-medium text-gray-600 p-2">
              {{ "calendar.days.tue" | translate }}
            </div>
            <div class="text-center text-sm font-medium text-gray-600 p-2">
              {{ "calendar.days.wed" | translate }}
            </div>
            <div class="text-center text-sm font-medium text-gray-600 p-2">
              {{ "calendar.days.thu" | translate }}
            </div>
            <div class="text-center text-sm font-medium text-gray-600 p-2">
              {{ "calendar.days.fri" | translate }}
            </div>
          </div>

          <!-- Calendar days grid -->
          <div class="grid grid-cols-7 gap-1">
            <ng-container *ngFor="let week of calendarWeeks">
              <button
                *ngFor="let day of week"
                type="button"
                class="p-2 text-center hover:bg-[#1B8354] hover:text-white rounded-md transition-colors relative"
                [class.selected-date]="isSelected(day)"
                [class.bg-blue-100]="isToday(day) && !isSelected(day)"
                [class.text-blue-600]="isToday(day) && !isSelected(day)"
                [class.text-gray-300]="day === 0"
                [class.cursor-not-allowed]="day === 0"
                [disabled]="day === 0"
                (click)="selectDay(day)"
              >
                <span *ngIf="day > 0">{{ day }}</span>
              </button>
            </ng-container>
          </div>
        </div>
      </div>

      <!-- Calendar Footer -->
      <div class="p-4 border-t border-gray-200 bg-gray-50">
        <div class="flex justify-between items-center">
          <button
            type="button"
            class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors"
            (click)="closeCalendar()"
          >
            {{ "common.cancel" | translate }}
          </button>
          <div class="text-xs text-gray-500">
            {{ type === "hijri" ? "Hijri Calendar" : "Gregorian Calendar" }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop for mobile -->
<div
  *ngIf="showCalendar"
  class="fixed inset-0 bg-black bg-opacity-25 z-40 md:hidden"
  (click)="closeCalendar()"
></div>
